The traditional ships deal with only a few MWs of electrical power, but with the incorporation of new technology for weapons, modern marine ship's power demand has increased drastically \cite{shen2012distributed}. The addition of pulsed loads such as electromagnetic aircraft launch system (EMALS) and electromagnetic rail gun (EMRG) lead to a significant increment of the ship service load's power demand. The main challenge with the incorporation of new pulsed loads is that traditional ships have limited dedicated prime movers for the ship service load. Most of the prime movers are responsible for producing power for the propulsion system and there is no connection between the propulsion system and ship service system. There is no way to use the power produced by the prime movers of the propulsion system for the new ship service load (EMALS and EMRG) even when the propulsion system is not in operation. The potential solution is to use  Integrated Power System (IPS) architecture for the shipboard power system \cite{shen2012distributed}. In this IPS structure based power system, all the loads (propulsion load and ship service load) are powered from the same generation sources. The remarkable achievement of this new IPS architecture is that the available power for the propulsion system can be used for the ship service load and it leads to the incorporation of the new pulsed load without the incorporation of the additional generators for the ship service load. Due to the significant advantages of the new IPS structure  based power system, the recent shipboards  such as  DDG-1000 Zumwalt-class destroyer, the T-AKE-1 Lewis-and-Clark-class cargo ship, the currently suspended CG(X) next generation cruiser, the LHA-6 Makin-Island-class amphibious assault ship, the Flight III Virginia-class attack submarine, and the CVN-21 Gerald-Ford-class aircraft carrier \cite{doerry2009next, pifer2010modeling} have been using this strategy for incorporation of the loads and sources.


A radical change of mechanical propulsion to electric propulsion produces a significant increase in electric power demand for the shipboard power system. With the incorporation of pulsed load (EMALS and EMRG), the electric power demand of the AES's power system is increased even more. The pulsed load demands high amplitude electric power within a very short time \cite{monti2008energy}. Traditional generators have limited ability to follow sudden changes of the load as the generators have long time constants for control of fuel valves and combustors. Considering the pulsed load demand and the incapability of the generators, the energy storage system has become a vital part of the electric shipboard. The main objectives of using energy storages in the shipboard power system are to maintain the balance of the sources and load power demand, maintain the bus voltage within the required range (10\% around the nominal voltage \cite{mystandard}), support the generators in meeting pulsed load demand, remove the negative effects of transient load, and to store surplus energy \cite{yfuzzy2016, mskhanhybrid2016, khan2017fuzzy, mskhanests2017}. 



The use of the potential energy storages (battery, flywheel, superconducting magnetic energy storage (SMES), and supercapacitor) on the shipboard are discussed in \cite{holsonback2006system}. Energy storages need to perform two types of operation: normal operation and transient operation. The normal operation is maintaining the balance between the load and generation and transient operation is to prevent power fluctuations. A single type of energy storage cannot perform both operations. In order to keep the balance between the source and load demand, an energy storage with high energy density (battery) is required. To prevent load fluctuations, an energy storages with high power density (supercapacitor) is needed to incorporate. Battery and supercapacitor are used as the energy storages in the shipboard power system in \cite{li2014real, cohen2016fuzzy}. In this paper, a hybrid energy storage system (HESS) consisted of a battery and a supercapacitor is proposed.  




Now the ultimate objective is to design an intelligent and efficient ESM system to control the operation of the energy storages. The key function of the ESM system is to generate the charging and discharging power reference of the HESS based on the mismatch of the sources and load power demand, system voltage, state of charge (SOC) of the energy storages, pulsed load activation. Energy storage management strategies for the energy storages are discussed in \cite{li2014real, cohen2016fuzzy, hou2015interaction, hou2016integrated, haseltalab2016multi}. Battery and supercapacitor are used as the backup energy storage devices for the shipboard power system and a proportional integral (PI) based strategy is used to control the charging and discharging of them in \cite{li2014real}. In \cite{cohen2016fuzzy}, a hybrid energy storage module (HESM) consisted of a lithium-ion battery (LIB) and a supercapacitor is used for naval pulsed load, and FL based technique is used to control the energy storages. In order to remove   the power and torque fluctuations on the electric ship propulsion system, battery and supercapacitor are used as the potential energy storage devices in \cite{hou2015interaction}. In \cite{hou2015interaction}, a model-based analysis is used to calculate the interactions of the energy storages with the existing generation systems. In the interest of coordinating different control systems of the energy sources and propulsion system with the energy storages, a model predictive control strategy is used in \cite{hou2016integrated}. With regard to smoothing the battery power, a model predictive based control strategy is used in \cite{bo2016battery} to save the battery from overheating. In \cite{haseltalab2016multi}, a nonlinear robust turbo-based model predictive control strategy is used for the energy management of hybrid ships. Two strategies (PI based and FL based) are introduced in \cite{zhang2010experimental} for energy storage management of a local DC distribution system of More Electric Aircraft. In this paper, an intelligent ESM system is designed based on FL control technique to control the operation of the HESS with the interest of aiding the generators in fulfilling transient and steady power demand of the AES. The outputs of the ESM system are the instantaneous reference powers for charging and discharging of the energy storages. To show the performance of the designed ESM system, a 40MW MVDC system is modeled using SimPowerSystems and a digital Real-Time Simulator (OPAL-RT). 


Real-time (RT) digital simulation is increasingly used in power and energy systems as a highly reliable simulation method. With the increase of the computational power of the RT simulation, models of the electrical system can be built and simulated more accurately to reflect the real behavior of the system \cite{guillaud2015applications}. A DRTS can be used to test part of a system which is real hardware. The process is known as hardware-in-the-loop (HIL) where part of the system is real hardware and the rest of the system is simulated in real-tie inside the DRTS. Controller hardware in the Loop(CHIL) is such a testing process where control function can be tested by interfacing the controls with the simulated system. CHIL based experiment provides the opportunity of testing a hardware built controller in real-time simulation environment which is very closer to reality \cite{faruque2010hardware,yoo2012hardware}.
\begin{itemize}
    \item It provides the facility to investigate a controller thoroughly before incorporating it to the real plant.
    
    \item It helps to test the controller under extreme conditions with reduced cost and risk.
    
    \item It helps to detect the hidden defects in the controller which may create serious consequences.
\end{itemize}
In CHIL based test system, an actual controller is tested against a simulated plant which runs in a real-time simulator. During CHIL based testing, different parts of the system are connected in a closed loop through various Inputs and Outputs (I/O) interfaces. Considering the importance of CHIL based testing, the ESM system is implemented on Field-programmable gate array (FPGA) and CHIL based experiments are conducted. Eventually the off-line and CHIL results are compared to validate the effectiveness of the controllers.
